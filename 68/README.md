# 68

## 概要

| 設定 | 経路                                                                               | Q 更新法      | パラメータ     | 商品判別   | 購入ルール                                   | 追加事項                      |
| ---- | ---------------------------------------------------------------------------------- | ------------- | -------------- | ---------- | -------------------------------------------- | ----------------------------- |
| 68   | ATM → 水、弁当、朝食、ペン、おやつをそれぞれ 2 つか 3 つのうちから 1 つずつ → レジ | 並列 Q 更新法 | ε = 0.01, Map1 | 写真で判別 | 最安値商品のみ購入。所持金不足なら購入しない | 　実行回数を 1000->100 に変更 |

## コードの流れ(main.py について)

- input から設定ファイルや q,地図を取得
- 買い物リストにある商品を全てカゴに入れる。
- checkout()でカゴの中を全て走査し、各カテゴリごとに最安値の 1 商品のみを購入する

## 設定ファイルについて(./input/config.json)

- version: このプロジェクトの番号
- item_amount: ./input/shopping_list 内の写真の枚数（実行後に自動作成）
- epsilon: ε の値
- starting_x: 開始地点の x 座標
- starting_y: 開始地点の y 座標
- prefer_lower_price_items: 各カテゴリの最安値の商品をそれぞれ購入する場合は true、先に見つけたものを購入する場合は false (現時点では true のみ可能)
- show_output:結果を都度ターミナルに出力するときは true
- title: 実験の手法

## 実行方法

- ./input/config.json を正しく設定する。
- 買い物リスト用の写真の名前は、`カテゴリ名_商品名.jpg` とする。(atm とレジは除く)
- $ ./execution.sh

## 実行後

全て完了後（execution.sh の中身を全て実行後）、output データをまとめて圧縮したものと、それらの平均をとった stats.csv が作成される。

## プロジェクト構造の詳細説明

### ルートディレクトリ

| ファイル/フォルダ | 説明                                                                   |
| ----------------- | ---------------------------------------------------------------------- |
| `config.json`     | 実験設定ファイル（バージョン、パラメータ、座標等）                     |
| `execution.sh`    | メイン実行スクリプト（仮想環境構築〜実験実行〜結果圧縮）               |
| `main.py`         | 強化学習エージェントのメインロジック（Q 学習、買い物シミュレーション） |
| `graph.py`        | 結果分析・統計処理スクリプト（CSV 出力、グラフ生成）                   |
| `reset.sh`        | プロジェクトリセット用スクリプト                                       |
| `venv/`           | Python 仮想環境（colorgram.py、PIL 等の依存関係）                      |

### input/ ディレクトリ（入力データ）

| フォルダ/ファイル | 説明                                                                                                                                                          |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `shopping_list/`  | 買い物リスト用画像（ATM、商品、レジ）<br/>- `atm.jpg`: ATM 画像<br/>- `cashier_register.jpg`: レジ画像<br/>- `カテゴリ_商品名.jpg`: 各商品画像                |
| `item_images/`    | マップ上の商品シンボル画像（A-Z、$、-）<br/>- 各画像はマップ上の商品位置に対応                                                                                |
| `map.txt`         | 20×50 の 2 次元マップ（商品配置、通路等）                                                                                                                     |
| `fresh_q/`        | 初期 Q 値テンプレート<br/>- `q0.txt`: 上方向の初期 Q 値<br/>- `q1.txt`: 右方向の初期 Q 値<br/>- `q2.txt`: 下方向の初期 Q 値<br/>- `q3.txt`: 左方向の初期 Q 値 |

### 実行時に作成されるディレクトリ

#### output/ ディレクトリ（実行結果）

| フォルダ/ファイル | 説明                                                                    |
| ----------------- | ----------------------------------------------------------------------- |
| `data/`           | 4 セットの実験結果<br/>- `0/`, `1/`, `2/`, `3/`: 各セットの結果ファイル |
| `tmp_data/`       | 実行中の一時データ（各セット完了後に`data/`に移動）                     |
| `stats.csv`       | 統計情報（最小値、最大値、平均値）                                      |

#### input/q/ ディレクトリ（Q 値データ）

| フォルダ構造  | 説明                                                                                                                                                                                                      |
| ------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `q/{商品ID}/` | 各商品の Q 値ディレクトリ<br/>- `q0.txt`: 上方向の Q 値（20×50 行列）<br/>- `q1.txt`: 右方向の Q 値（20×50 行列）<br/>- `q2.txt`: 下方向の Q 値（20×50 行列）<br/>- `q3.txt`: 左方向の Q 値（20×50 行列） |

### 実行フロー

1. **初期化**: 仮想環境構築、Q 値リセット、出力ディレクトリ作成
2. **実験実行**: 4 セット × 1000 回のシミュレーション
3. **Q 値更新**: 各実行後に Q 値を保存
4. **結果分析**: 統計情報の計算・CSV 出力
5. **圧縮**: 結果を ZIP ファイルに圧縮

### 出力ファイル形式

#### 個別実行結果（`output/data/{セット番号}/{日付}_{時間}.txt`）

```
{version} output data

Passing Points:
(座標1)
(座標2)
...

Epsilon: 0.01

Shopping List:
- 商品名1
- 商品名2
...

Visit order:
1, { Symbol: A, Name: 商品名, Price: 価格¥ }
...

Items purchased:
{商品名: 価格¥}
...

Initial money: 初期所持金¥
Cash balance: 残金¥
Is shopping successful?: true/false
Progress: 進捗
Steps: 歩数

Map:
(20×50のマップ表示)
```

#### 統計ファイル（`stats.csv`）

```csv
Title,Min,Max,Average
file68,最小歩数,最大歩数,平均歩数
```

### パフォーマンス最適化のポイント

- **実行時間**: 現在約 67 分（1000 回 ×4 セット + sleep）
- **メモリ使用量**: Q 値で約 52,000 個の浮動小数点値
- **最適化案**: 実行回数削減、sleep 短縮、並列処理導入
